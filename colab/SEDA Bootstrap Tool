{"cells":[{"cell_type":"code","source":["import os\n","import sys\n","import base64\n","\n","# The \"Self-Exploding\" Header\n","# This makes the file executable Python AND readable Markdown.\n","BOOTSTRAP_HEADER = r'''#!/usr/bin/env python3\n","\"\"\"\n","# üì¶ Self-Extracting Document Archive (SEDA)\n","\n","This file is a **self-extracting archive**. You can read it as documentation, or you can **run it** to unpack the contents.\n","\n","## üöÄ Quick Start\n","\n","To extract the contents of this archive, simply run this file with Python:\n","\n","```bash\n","python {filename}"],"outputs":[],"execution_count":null,"metadata":{"id":"Uj1NLkJAbhOw"}},{"cell_type":"markdown","source":["## üìÑ Contents\n","\n","This archive contains the following files:\n","{file_list}\n","\n","---\n","**Technical Details:**\n","This file is a valid Python script that contains a payload of files encoded in Base64.\n","When executed, it will recreate the directory structure in your current folder.\n","\n","_(The extraction logic is embedded below this documentation)_\n","\"\"\"\n","import os\n","import base64\n","import sys\n","\n","# --- END OF DOCUMENTATION / START OF PAYLOAD ---\n","'''\n","\n","# The Extractor Logic (The \"Engine\" inside the document)\n","EXTRACTOR_LOGIC = r'''\n","def extract_payload():\n","    print(f\"üí• Self-Exploding SEDA Archive: {os.path.basename(__file__)}\")\n","    print(\"   Extracting files...\")\n","    \n","    for filepath, content in PAYLOAD.items():\n","        # Determine destination\n","        dest_path = os.path.join(os.getcwd(), filepath)\n","        directory = os.path.dirname(dest_path)\n","        \n","        # Create directories\n","        if directory:\n","            os.makedirs(directory, exist_ok=True)\n","        \n","        # Write file\n","        try:\n","            # If content is bytes (binary), write directly\n","            if isinstance(content, bytes):\n","                with open(dest_path, 'wb') as f:\n","                    f.write(content)\n","            # If content is string (text or base64 representation), handle accordingly\n","            elif isinstance(content, str):\n","                 # Heuristic: If it looks like a text file, try writing as text\n","                 # Otherwise try decoding base64\n","                 try:\n","                     # Try treating as base64 first for known binary extensions\n","                     if filepath.endswith(('.png', '.jpg', '.ico', '.svg', '.pdf', '.zip', '.exe')):\n","                         with open(dest_path, 'wb') as f:\n","                            f.write(base64.b64decode(content))\n","                     else:\n","                         # Default to text\n","                         with open(dest_path, 'w', encoding='utf-8') as f:\n","                            f.write(content)\n","                 except Exception:\n","                     # Fallback: write as raw text if decoding fails\n","                     with open(dest_path, 'w', encoding='utf-8') as f:\n","                        f.write(content)\n","\n","            print(f\"   ‚úÖ Extracted: {filepath}\")\n","        except Exception as e:\n","            print(f\"   ‚ùå Error extracting {filepath}: {e}\")\n","\n","    print(\"\\n‚ú® Explosion complete! All files extracted. ‚ú®\")\n","\n","if __name__ == \"__main__\":\n","    extract_payload()\n","'''\n","\n","IGNORE_DIRS = {\n","    'node_modules', '__pycache__', '.git', 'dist', 'build',\n","    '.DS_Store', '.idea', '.vscode', 'coverage'\n","}\n","\n","IGNORE_EXTENSIONS = {\n","    '.pyc', '.log', '.seda', '.exe', '.dll', '.so', '.dylib', '.zip'\n","}\n","\n","def is_binary(file_path):\n","    \"\"\"Check if file is binary.\"\"\"\n","    try:\n","        with open(file_path, 'tr') as check_file:\n","            check_file.read()\n","            return False\n","    except:\n","        return True\n","\n","def create_bootstrap_seda(source_dir, output_filename):\n","    source_dir = os.path.abspath(source_dir)\n","    \n","    if not os.path.exists(source_dir):\n","        print(f\"Error: Source directory '{source_dir}' does not exist.\")\n","        return\n","\n","    print(f\"üß® Preparing self-exploding document from '{os.path.basename(source_dir)}'...\")\n","\n","    file_data = {}\n","    file_list_md = \"\"\n","\n","    for root, dirs, files in os.walk(source_dir):\n","        dirs[:] = [d for d in dirs if d not in IGNORE_DIRS]\n","        \n","        for file in files:\n","            if any(file.endswith(ext) for ext in IGNORE_EXTENSIONS):\n","                continue\n","            \n","            full_path = os.path.join(root, file)\n","            rel_path = os.path.relpath(full_path, source_dir).replace('\\\\', '/')\n","            \n","            file_list_md += f\"- `{rel_path}`\\n\"\n","\n","            try:\n","                if is_binary(full_path):\n","                    with open(full_path, \"rb\") as f:\n","                        encoded = base64.b64encode(f.read()).decode('utf-8')\n","                        file_data[rel_path] = encoded\n","                else:\n","                    with open(full_path, \"r\", encoding=\"utf-8\") as f:\n","                        file_data[rel_path] = f.read()\n","                print(f\"   ‚ûï Added: {rel_path}\")\n","            except Exception as e:\n","                print(f\"   ‚ö†Ô∏è Skipping {rel_path}: {e}\")\n","\n","    # Assemble the document\n","    with open(output_filename, \"w\", encoding=\"utf-8\") as out:\n","        # 1. Write the Header (Shebang + Markdown Doc)\n","        header = BOOTSTRAP_HEADER.format(\n","            filename=os.path.basename(output_filename),\n","            file_list=file_list_md\n","        )\n","        out.write(header)\n","        \n","        # 2. Write the Payload Dictionary\n","        out.write(\"\\n# Payload Data\\nPAYLOAD = {\\n\")\n","        for path, content in file_data.items():\n","            # Use repr() for safe string representation\n","            out.write(f\"    '{path}': {repr(content)},\\n\")\n","        out.write(\"}\\n\")\n","        \n","        # 3. Write the Extractor Logic\n","        out.write(EXTRACTOR_LOGIC)\n","\n","    # Make it executable (Unix/Linux/Mac)\n","    try:\n","        mode = os.stat(output_filename).st_mode\n","        os.chmod(output_filename, mode | 0o111)\n","    except:\n","        pass\n","\n","    print(f\"\\nüéâ Self-Exploding Document created: {output_filename}\")\n","    print(f\"   Try running it: ./ {output_filename}  (or python {output_filename})\")\n","\n","if __name__ == \"__main__\":\n","    if len(sys.argv) < 2:\n","        print(\"Usage: python seda_bootstrap.py <directory_to_pack> [output_filename.py]\")\n","    else:\n","        target_dir = sys.argv[1]\n","        output_name = sys.argv[2] if len(sys.argv) > 2 else f\"{os.path.basename(os.path.abspath(target_dir))}_installer.py\"\n","        create_bootstrap_seda(target_dir, output_name)\n","  ```"],"metadata":{"id":"EWhhYn7kbhOx"}}],"metadata":{"colab":{"provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"}},"nbformat":4,"nbformat_minor":0}